---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(a11ytables)
```

# {a11ytables}

<!-- badges: start -->
[![Project Status: WIP – Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)
[![CRAN
status](https://www.r-pkg.org/badges/version/a11ytables)](https://CRAN.R-project.org/package=a11ytables)
[![R-CMD-check](https://github.com/co-analysis/a11ytables/workflows/R-CMD-check/badge.svg)](https://github.com/co-analysis/a11ytables/actions)
[![Codecov test
coverage](https://codecov.io/gh/co-analysis/a11ytables/branch/main/graph/badge.svg)](https://codecov.io/gh/co-analysis/a11ytables?branch=main)
<!-- badges: end -->

## Purpose

{a11ytables} is a work-in-progress R package built around [{openxlsx}](https://ycphs.github.io/openxlsx/) that aims you to comply with the latest guidance (June 2021) on [releasing statistics in spreadsheets](https://gss.civilservice.gov.uk/policy-store/releasing-statistics-in-spreadsheets/) from the [Best Practice and Impact Division](https://github.com/best-practice-and-impact?language=html) (BPID) of the UK's [Government Statistical Service](https://gss.civilservice.gov.uk/).

The code is under development and current API features may change in future releases. Please see the NEWS file for details of any breaking changes.

## Install and use

You can install {a11ytables} from GitHub using {remotes}. The {openxlsx} package will be installed too.

```{r install, eval=FALSE}
install.packages("remotes")
remotes::install_github("co-analysis/a11ytables")
library(a11ytables)
```

To use:

1. Get your data into an a11ytables-class object using `new_a11ytable()`
2. Populate an {openxlsx} Workbook-class object from that object, using `create_a11y_wb()`
3. Write the workbook to a spreadsheet output with `openxlsx::saveWorkbook()`

## Example

### 1. Create a11ytable object

First, construct a special a11ytable-class object using `new_a11ytable()`. Ultimately, it's a data.frame with strict requirements. It requires a row per sheet and columns for needed information, like the sheet title (character) and table of data (itself a data.frame); run `?new_a11ytable` for details.

There's a built-in demo dataset---`lfs_tables`, adapted from [the releasing statistics in spreadsheets guidance](https://gss.civilservice.gov.uk/policy-store/releasing-statistics-in-spreadsheets/)---that is already in the correct data.frame format.

```{r glimpse-lfs-tables}
dplyr::glimpse(lfs_tables)
```

It can be coerced to a11ytable class, since it's already structured correctly.

```{r as-a11ytable}
lfs_a11ytable <- as_a11ytable(lfs_tables)
class(lfs_a11ytable)
is_a11ytable(lfs_a11ytable)
```

### 2. Convert to workbook

We can pass this a11ytable-class object to `create_a11y_wb()`, which constructs an {openxlsx} Workbook-class object with accessibility-appropriate styling.

```{r create-a11ytable-wb}
lfs_wb <- create_a11y_wb(lfs_a11ytable)
```

<details><summary>Click here to view the contents of the workbook</summary>

```{r print-wb}
lfs_wb
```

</details>
<p>

### 3. Save

This output can be written to disk or opened temporarily with spreadsheet software.

```{r open-wb, eval=FALSE}
openxlsx::openXL(lfs_wb)  # optionally open temp copy
openxlsx::saveWorkbook(lfs_wb, "publication.xlsx")
```

## Accessibility

TODO: explain features that meet the GSS accessibilit guidance (named tables, no empty cells, the statement on table count and presence of notes, etc).

## Similar projects

BPID have themselves released [a Python package called 'gptables'](https://github.com/best-practice-and-impact/gptables) to help users produce such spreadsheets, but it's based on a prior version of the guidance. [That package will be updated](https://github.com/best-practice-and-impact/gptables/issues/145), but there's a gap for this functionality—and for a dedicated R package—at the time of writing (August 2021).

{a11ytables} is being developed with specific statistical releases in mind, but the goal is to generalise it and perhaps have some functionality absorbed into the development of [gptables](https://github.com/best-practice-and-impact/gptables) in some way.

## Code of Conduct

Please note that the {a11ytables} project is released with a [Contributor Code of Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.

Cabinet Office users, please adhere to [the co-analysis Git and GitHub code of conduct and usage policy](https://docs.google.com/document/d/1CuNgKla1BwSVOmGkPmsq0S-OM4emP-iXrgnm7EeILWM/edit?usp=sharing).

Please [file an issue](https://github.com/co-analysis/csstatsbulletin/issues) where possible and provide meaningful commentary in any commits and pull requests.

## Copyright

Copyright (c) 2021 Crown Copyright (Cabinet Office).

The code in this repository is released under the MIT license as per [The GDS Way](https://gds-way.cloudapps.digital/manuals/licensing.html#use-mit).
