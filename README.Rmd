---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(a11ytables)
```

# {a11ytables}

<!-- badges: start -->
[![Project Status: WIP – Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)
[![CRAN
status](https://www.r-pkg.org/badges/version/a11ytables)](https://CRAN.R-project.org/package=a11ytables)
[![R-CMD-check](https://github.com/co-analysis/a11ytables/workflows/R-CMD-check/badge.svg)](https://github.com/co-analysis/a11ytables/actions)
[![Codecov test
coverage](https://codecov.io/gh/co-analysis/a11ytables/branch/main/graph/badge.svg)](https://codecov.io/gh/co-analysis/a11ytables?branch=main)
<!-- badges: end -->

## Purpose

{a11ytables} is a work-in-progress R package built around [{openxlsx}](https://ycphs.github.io/openxlsx/) that aims to comply with the latest guidance (June 2021) on [releasing statistics in spreadsheets](https://gss.civilservice.gov.uk/policy-store/releasing-statistics-in-spreadsheets/) from the [Best Practice and Impact Division](https://github.com/best-practice-and-impact?language=html) (BPID) of the UK's [Government Statistical Service](https://gss.civilservice.gov.uk/).

## Install

You can install {a11ytables} from GitHub using {remotes}:

```{r install, eval=FALSE}
install.packages("remotes")  # if not yet installed
remotes::install_github("co-analysis/a11ytables")
library(a11ytables)
```

The package depends on {openxlsx} for constructing workbooks and {purrr} for human-readable function iteration. Both are imported with {a11ytables}. The {magrittr} pipe (`%>%`) is exported for convenience.

## How to

### Concept

At simplest, there are two steps:

1. Create an input dataframe---the _contents_ object---with a specific format
2. Pass that dataframe to `create_a11y_wb()`

Conceptually, a _workbook_ is made of _sheets_. There are two types of sheet: _meta_ (_cover_, _contents_ and optional _notes_) and _tables_. 

Sheets are built from _elements_, which includes the title, an announcement on the number of tables/presence of notes, an announcement of the source, and the tables themselves

The `create_a11y_wb()` function takes a user-supplied _contents_ object and creates an {openxlsx} Workbook-class object for you, then generates the tabs and fills them with content based on the supplied _contents_ object.

The _contents_ object has a very strict format. It's a data.frame object that contains the information needed to construct each sheet. The columns and certain contents must follow particular requirements. 

### Input

The input dataframe `content` should contain all the information you need to populate your workbook. As an example, here is the built-in dataset `lfs_tables`, adapted from [the releasing statistics in spreadsheets guidance](https://gss.civilservice.gov.uk/policy-store/releasing-statistics-in-spreadsheets/):

```{r glimpse-lfs-tables}
dplyr::glimpse(tibble::as_tibble(lfs_tables))
```

In short, your dataframe should have one row per workbook tab and must contain the columns:

* `tab_title`: the name of the tab (i.e. the text that will appear on each tab of the output workbook), a column that must include 'cover' and 'contents'; optionally 'notes'; and one row per table for publication (numbers are recommended for tables)
* `sheet_type`: 'cover', 'contents' and 'notes' are 'meta' sheets; tables for publication are 'tables'
* `sheet_title`: the title of the sheet, displayed in cell A1
* `source`: the provenance of the data (optional), displayed in cell A3
* `table_name`: a name to give the marked-up table (no spaces), which will allow screenreaders to identify the table in the output workbook
* `table`: a list-column containing a dataframe with the table to be added to  a given sheet

Optionally, for tabs that contain more than one table (not recommended, not yet supported):

* `subtable_num`: string to append to the tab_title to identify this sub-table, for example 'a' and 'b'
* `subtable_title`: title to be added above the sub-table within the sheet

### Create

And then to create the accessible workbook output, you would pass your _content_ object to this single function:

```{r example_wb}
example_wb <- create_a11y_wb(lfs_tables)
```

<details><summary>This creates an {openxlsx} Workbook-class object; click here to view the contents.</summary>
```{r}
example_wb
```
</details>
<p>

This object can be saved to a spreadsheet. Open a temporary copy with `openXL()` or write it with `saveWorkbook()`:

```{r open-wb, eval=FALSE}
openxlsx::openXL(example_wb)  # optionally open temp copy
openxlsx::saveWorkbook(example_wb, "publication.xlsx")
```

## Similar projects

BPID have themselves released [a Python package called 'gptables'](https://github.com/best-practice-and-impact/gptables) to help users produce such spreadsheets, but it's based on a prior version of the guidance. [That package will be updated](https://github.com/best-practice-and-impact/gptables/issues/145), but there's a gap for this functionality—and for a dedicated R package—at the time of writing (August 2021).

{a11ytables} is being developed with specific statistical releases in mind, but the goal is to generalise it and perhaps have some functionality absorbed into the development of [gptables](https://github.com/best-practice-and-impact/gptables) in some way.

## Code of Conduct

Please note that the {a11ytables} project is released with a [Contributor Code of Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.

Cabinet Office users, please adhere to [the co-analysis Git and GitHub code of conduct and usage policy](https://docs.google.com/document/d/1CuNgKla1BwSVOmGkPmsq0S-OM4emP-iXrgnm7EeILWM/edit?usp=sharing).

Please [file an issue](https://github.com/co-analysis/csstatsbulletin/issues) where possible and provide meaningful commentary in any commits and pull requests.

## Copyright

Copyright (c) 2021 Crown Copyright (Cabinet Office).

The code in this repository is released under the MIT license as per [The GDS Way](https://gds-way.cloudapps.digital/manuals/licensing.html#use-mit).
