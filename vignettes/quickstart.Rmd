---
title: "Get started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{quickstart}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#"
)
```

## Purpose

This vignette shows you quickly how to generate a spreadsheet output with {a11ytables} that is compliant with [good practice guidance](https://gss.civilservice.gov.uk/policy-store/releasing-statistics-in-spreadsheets/).

## Steps

There are three steps:

1. Use `new_a11ytable()` to create a special dataframe of your data
1. Use `create_a11y_wb()` to add styles and workbook structure
1. Use `openxlsx::saveWorkbook()` to write an xlsx file

## 1. Create an a11ytable

`new_a11ytable()` helps you create an 'a11ytable', which is a special type of dataframe that contains all the information required to make a publishable spreadsheet.

Each argument provides an element of information for each sheet, like the tab title, the type of sheet (cover, contents, etc) and the data source.

You provide the majority of information to each worksheet as a dataframe, passed to the `tables` argument. It's usually best to create these first, before passing them to `new_a11ytable()`.

<details><summary>Click for an example of pre-prepared tables</summary>
```{r tables}
library(tibble)

# A cover page, with subheaded sections of information
cover_df <- tribble(
  ~"Subsection title", ~"Subsection body",
  "Description", "The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973â€“74 models)",
  "Format", "A data frame with 32 observations on 11 (numeric) variables."
)

# A contents page, with the sheet names and titles
contents_df <- tribble(
  ~"Sheet name", ~"Sheet title",
  "Notes", "Notes",
  "Table 1", "Motor Trend Car Road Tests"
)

# A notes page, a lookup of codes to information 
notes_df <- tribble(
  ~"Note number", ~"Note text",
  "[c]", "Confidential: suppressed.",
  "[z]", "Not applicable.",
  "[1]", "Hocking [original transcriber]'s noncrucial coding of the Mazda's rotary engine as a straight six-cylinder engine and the Porsche's flat engine as a V engine, as well as the inclusion of the diesel Mercedes 240D, have been retained to enable direct comparisons to be made with previous analyses.",
  "[2]", "Test note.",
  "[3]", "Test note."
)

# An example statistical table, made using the in-built mtcars dataset
# Suppression ('[c]') and notes markers ('[1]') added as examples 
cars_df <- tibble::rownames_to_column(mtcars, "car") |>
  subset(select = c("car", "mpg", "cyl", "disp", "hp"))
cars_df[1, "mpg"] <- "[c]"  # suppress
cars_df[2:nrow(cars_df) , "cyl"] <- "[c]"  # suppress
notes_cars <- c("Mazda RX4", "Mazda RX4 Wag", "Porsche 914-2", "Merc 240D")
cars_df[["Notes"]] <- ifelse(  # notes column
  cars_df[["car"]] %in% notes_cars,
  "[1]", "[z]"
)
names(cars_df) <- c(  # notes in column headers
  "Car",
  "Miles per gallon [2]",
  "Cylinders [2, 3]",
  "Displacement [note 2]",
  "Horsepower [note]",
  "Notes"
)
```
</details>

Here's how to construct a new a11ytable by passing information, including our pre-prepared tables, to `new_a11ytable()`.

```{r new-a11ytable}
library(a11ytables)

a11y_new <- new_a11ytable(
  tab_titles = c("Cover", "Contents", "Notes", "Table 1"),
  sheet_types = c("cover", "contents", "notes", "tables"),
  sheet_titles = c(
    "The mtcars demo datset: 'Motor Trend Car Road Tests'",
    "Table of contents",
    "Notes",
    "Motor Trend Car Road Tests"
  ),
  sources = c(
    NA_character_,
    NA_character_,
    NA_character_, 
    "Motor Trend (1974)"
  ),
  table_names = c(
    "cover_sheet",
    "table_of_contents",
    "notes_table",
    "demographic_benchmarks"
  ),
  tables = list(
    cover_df,
    contents_df,
    notes_df,
    cars_df
  )
)

a11y_new
```

So, it created a dataframe with one row per sheet and one column per sheet 'element'.

See [the 'construct an a11ytable' vignette](https://co-analysis.github.io/a11ytables/articles/construct.html) for more information on setting up an a11ytable-class object.

## 2. Convert to a workbook

Your a11ytable is just a dataframe until we use `create_a11y_wb()` to convert it to an [{openxlsx}](https://ycphs.github.io/openxlsx/) workbook object, which applies markup and styling to meet best practice guidance.

```{r create-a11y-wb}
a11y_wb <- create_a11y_wb(a11y_new)

a11y_wb
```

You can see that each sheet has been created with custom styling.

## 3. Write to file

Finally, you can use the `saveWorkbook()` function from [{openxlsx}](https://ycphs.github.io/openxlsx/) to save your workbook object to an xlsx file.

```{r saveworkbook, eval=FALSE}
saveWorkbook(a11y_wb, "publication.xlsx")
```
